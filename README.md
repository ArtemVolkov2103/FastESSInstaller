# Установщик личного кабинета версий 2.X
Разворачивает (удаляя предыдущую версию, поставленную этой утилитой) сервисы ЛК.

### Что реализовано:
1. Очистка папки, куда будет устанавливаться ЛК, удаляются сайты и пулы, название которых идентично новым.
2. Создание структуры папок, извлечение файлов из архивов.
3. Создание БД, если их нет.
4. Инициализация БД.
5. Заполнение конфигурационных файлов сервисов.
6. Добавление в IIS сайтов и пулов для сервисов (заменяя предыдущие с таким же названием), настройка web.config.
7. Выполнение консольных команд для утилит EssCLI и IdCLI.

Данной утилитой устанавливаются только самые необходимые сервисы: "DocumentService","EssCLI", "EssService", "EssSite", "IdCLI", "IdentityService", "Sheduler", "WebApiService", "SignService", "StorageService".
Возможно, позже будут добавлены в установщик и другие, как PreviewService

### Использование
Преименовать файл Config_example.json в Config.json, заполнить его своими настройками. 
Открыть решение, запустить выполнение.
В IIS открыть привязки сайтов EssService, EssSite, IdentityService, SignService, "Изменить", в окне "Изменение привязки сайта" выбрать SSL-сертификат. 
Проверить работоспособность сервисов через "\ready". 

В консоли много ошибок быть не должно. При нормальной установке ЛК версии 2.4 могут быть всего 3 ошибки - отсутствие файла MobilGroupTransport-win-x64.zip при распаковке архивов(если их нет в папке с сервисом), не найдены иконки сайта и сервиса Ess при выполнении консольных команд.
Консоль закрывать сразу не нужно, все логирование проводится в неё. В дальнейшем, возможно, логирование будет вестить в лог-файл.

Важно! Установщик не удаляет БД, и при повторном запуске лишь скажет, что БД уже существует.
Если установщик выдает ошибку, связанную с тем, что процесс "ess" запущен, то просто нужно раскомментировать //process.Kill();

### Заметки к заполнению Config.json
Если путь к сервисам будет браться со страницы "Платформа HRPro", то "OnePathToServices" ставить true и путь указать в PathToArhievedServices. Если на RN платформа не выпущена, то брать пути до сервисов по отдельности с RN и записывать в PathsToArhievedStageServices.

Поддерживается работа только с PostgreSQL, позже будет добавлена возможность использовать MSSQL

Если указать MessagingServiceHost не localhost, то для MessageBroker не будут распакованы архивы и настроены конфиги. Пока что подразумевается, что остальные сервисы будут работать локально.

ServiceFolders хотя и вынесена в конфиг, но названия папок менять нельзя. В дальнейшем это будет изменено.

### Идея создания установщика принадлежит Эльмиру Габтрахманову, и данный установщик создавал, оглядываясь на его.

## Установщик создан быстро, в личное свободное время. Если вы можете предложить улучшение, то присылайте PR или пишите в ММ. Это не конечная версия)
